<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="generator" content="Madoko, version 1.0.3" />
  <meta name="viewport" content="initial-scale=1.0" />
  <style type="text/css"  class="link">
  /*# sourceURL=madoko.css */
  
  .madoko .toc>.tocblock .tocblock .tocblock {
    margin-left: 2.25em;
  }
  .madoko .toc>.tocblock .tocblock {
    margin-left: 1.5em;
  }
  .madoko .toc-contents>.tocblock>.tocitem {
    font-weight: bold;
  }
  .madoko .toc {
    margin-top: 1em;
  }
  .madoko p.para-continue {
    margin-bottom: 0pt;
  }
  .madoko .para-block+p {
    margin-top: 0pt;
  }
  .madoko ul.para-block, .madoko ol.para-block {
    margin-top: 0pt;
    margin-bottom: 0pt;
  }
  .madoko ul.para-end, .madoko ol.para-end {
    margin-bottom: 1em;
  }
  .madoko dl {
    margin-left: 0em;
  }
  .madoko blockquote {
    font-style: italic;
  }
  .madoko a.localref {
    text-decoration: none;
  }
  .madoko a.localref:hover {
    text-decoration: underline;
  }
  .madoko .footnotes {
    font-size: smaller;
    margin-top: 2em;
  }
  .madoko .footnotes hr {
    width: 50%;
    text-align: left;
  }
  .madoko .footnote { 
    margin-left: 1em;
  }
  .madoko .footnote-before {
    margin-left: -1em;
    width: 1em;
    display: inline-block;
  }
  .madoko .align-center, .madoko .align-center>p {
    text-align: center !important;
  }
  .madoko .align-center pre {
    text-align: left;
  }
  .madoko .align-center>* {
    margin-left: auto !important;
    margin-right: auto !important;
  }
  .madoko .align-left, .madoko .align-left>p {
    text-align: left !important;
  }
  .madoko .align-left>* {
    margin-left: 0pt !important;
    margin-right: auto !important;
  }
  .madoko .align-right, .madoko .align-right>p {
    text-align: right !important;
  }
  .madoko .align-right>* {
    margin-left: auto !important;
    margin-right: 0pt !important;
  }
  .madoko .align-center>table,
  .madoko .align-left>table,
  .madoko .align-right>table {
    text-align: left !important;
  }
  .madoko .equation-before {
    float: right;
  }
  .madoko .bibitem {
    font-size: smaller;
  }
  .madoko .bibsearch {
    font-size: x-small;
    text-decoration:none;
    color: black;
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  .madoko .block, .madoko .figure, .madoko .bibitem, .madoko .equation, .madoko div.math {
    margin-top: 1ex;
    margin-bottom: 1ex;
  }
  .madoko .figure {
    padding: 0.5em;
    margin-left: 0pt;
    margin-right: 0pt;
  }
  .madoko .hidden {
    display: none;
  }
  .madoko .invisible {
    visibility: hidden;
  }
  .madoko.preview .invisible {
    visibility: visible;
    opacity: 0.5;
  }
  .madoko code.code, .madoko span.code {
    white-space: pre-wrap;
  }
  .madoko hr, hr.madoko {
    border: none;
    border-bottom: black solid 1px;
    margin-bottom: 0.5ex;
  }
  .madoko .framed>*:first-child {
    margin-top: 0pt;
  }
  .madoko .framed>*:last-child {
    margin-bottom: 0pt;
  }
  .madoko ul.list-style-type-dash {
      list-style-type: none !important;
  }
  .madoko ul.list-style-type-dash > li:before {
      content: "\2013"; 
      position: absolute;
      margin-left: -1em; 
  }
  .madoko table.madoko {
    border-collapse: collapse;
  }
  .madoko td, .madoko th {
    padding: 0ex 0.5ex;
    margin: 0pt;
    vertical-align: top;
  }
  .madoko .cell-border-left {
    border-left: 1px solid black;
  }
  .madoko .cell-border-right {
    border-right: 1px solid black;
  }
  .madoko thead>tr:first-child>.cell-line,
  .madoko tbody:first-child>tr:first-child>.cell-line {
    border-top: 1px solid black;
    border-bottom: none;
  }
  .madoko .cell-line, .madoko .cell-double-line {
    border-bottom: 1px solid black;
    border-top: none;
  }
  .madoko .cell-double-line {
    border-top: 1px solid black;
    padding-top: 1.5px !important;
  }
  .madoko .input-mathpre .MathJax_Display {
    text-align: left !important;
  }
  .madoko div.input-mathpre {
    text-align: left;
    margin-top: 1.5ex;
    margin-bottom: 1ex;
  }
  .madoko .math-rendering {
    color: gray;
  }
  .madoko .mathdisplay {
    text-align: center;
  }
  .madoko .pretty table {
    border-collapse: collapse;
  }
  .madoko .pretty td {
    padding: 0em;
  }
  .madoko .pretty td.empty {
    min-width: 1.5ex;
  }
  .madoko .pretty td.expander {
    width: 100em;
  }
  body.madoko, .madoko .serif {
    font-family: Cambria,"Times New Roman","Liberation Serif","Times",serif;
  }
  .madoko .sans-serif {
    font-family: "Calibri", "Optima", sans-serif;
  }
  .madoko .symbol {
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  body.madoko {  
    -webkit-text-size-adjust: 100%;       
    text-rendering: optimizeLegibility;
  }
  body.madoko {
    max-width: 88ex; 
    margin: 1em auto;
    padding: 0em 2em;  
  }
  body.preview.madoko {
    padding: 0em 1em;
  }
  .madoko p {
    text-align: justify;
  }
  .madoko h1, .madoko h2, .madoko h3, .madoko h4 { 
    margin-top: 1.22em; 
    margin-bottom: 1ex;
  }
  .madoko h1+p, .madoko h2+p, .madoko h3+p, .madoko h4+p, .madoko h5+p  { 
    margin-top: 1ex;    
  }
  .madoko h5, .madoko h6 { 
    margin-top: 1ex;
    font-size: 1em;
  }
  .madoko h5 { 
    margin-bottom: 0.5ex;
  }
  .madoko h5 + p {
    margin-top: 0.5ex;
  }
  .madoko h6 { 
    margin-bottom: 0pt;
  }
  .madoko h6 + p {
    margin-top: 0pt;
  }
  .madoko pre, .madoko code, .madoko kbd, .madoko samp, .madoko tt, 
  .madoko .monospace, .madoko .token-indent, .madoko .reveal pre, .madoko .reveal code, .madoko .email {
    font-family: Consolas,"Andale Mono WT","Andale Mono",Lucida Console,Monaco,monospace,monospace;
    font-size: 0.85em;
  }
  .madoko pre code, .madoko .token-indent {
    font-size: 0.95em;
  }
  .madoko pre code {
    font-family: inherit !important;
  }
  .madoko ol.linenums li {
    background-color: white;
    list-style-type: decimal;
  }
  .madoko .remote {
    background-color: #F0FFF0;
  }
  .madoko .remote + * {
    margin-top: 0pt;
  }
  @media print {
    body.madoko {
      font-size: 10pt;
    }
    @page {
      margin: 1in 1.5in;
    }
  }
  @media only screen and (max-device-width:1024px) {
    body.madoko {
      padding: 0em 0.5em;    
    }
    .madoko li {
      text-align: left;
    }
  }
  
    </style>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$']]},
       TeX: { 
         Macros: { mathid: ['\\mathit{#1\\hspace{0.1ex}}',1],
                   mathkw: ['\\mathsf{#1}',1],
                   mdmathindent: ['\\hspace{#1ex}',1],
                   mathpre: ['#1',1],
                 },
  
       }
    });
    MathJax.Hub.Register.StartupHook('TeX AMSmath Ready',function () { 
      MathJax.InputJax.TeX.Definitions.environment['mdmathpre'] = ['AMSarray',null,null,null,'l','0em','0em'];
    });
  </script>
  <script type="text/javascript" class="preview"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  
  </head>
<body class="madoko">

<div class="body madoko" style="line-adjust:0">
<div class="mathdefs input-mathdefs" data-line="6">\[\newcommand\lder[1]{\frac{D{#1}}{Dt}}
\newcommand\xder[1]{\frac{\partial{#1}}{\partial x}}\]</div><h2 id="sec-lare1d-code-writing" class="h1" data-line="11" data-heading-depth="1" style="display:block"><span data-line="11"></span><span class="heading-before"><span class="heading-label">1</span>.&#8194;</span><span data-line="11"></span>Lare1D code writing</h2><h3 id="sec-language-choice" class="h2" data-line="13" data-heading-depth="2" style="display:block"><span data-line="13"></span><span class="heading-before"><span class="heading-label">1.1</span>.&#8194;</span><span data-line="13"></span>Language choice</h3>
<p class="p noindent" data-line="15"><span data-line="15"></span>Originally started using Python with a view to using Cython, but realised that it may be a little progressive. Same with using Julia. Using C++ instead and may port over to Cython at some point as an exercise/tutorial writing opportunity. 1D though so no need to involve threading or MPI/openMP.
</p><h4 id="sec-advantages-to-c" class="h3" data-line="17" data-heading-depth="3" style="display:block"><span data-line="17"></span><span class="heading-before"><span class="heading-label">1.1.1</span>.&#8194;</span><span data-line="17"></span>Advantages to C++</h4>
<ul class="ul list-star compact" data-line="18">
<li class="li ul-li list-star-li compact-li" data-line="18"><span data-line="18"></span>Fast 
</li>
<li class="li ul-li list-star-li compact-li" data-line="19"><span data-line="19"></span>Modern constructs compared to fortran
</li>
<li class="li ul-li list-star-li compact-li" data-line="20"><span data-line="20"></span>More readable than Fortran
</li>
<li class="li ul-li list-star-li compact-li" data-line="21"><span data-line="21"></span>I know it<span data-line="21"></span>&#8230;<span data-line="21"></span>
</li></ul>
<h4 id="sec-disadvantages-to-c" class="h3" data-line="23" data-heading-depth="3" style="display:block"><span data-line="23"></span><span class="heading-before"><span class="heading-label">1.1.2</span>.&#8194;</span><span data-line="23"></span>Disadvantages to C++</h4>
<ul class="ul list-star compact" data-line="24">
<li class="li ul-li list-star-li compact-li" data-line="24"><span data-line="24"></span>Still more clunky/boilerplate code than Python
</li>
<li class="li ul-li list-star-li compact-li" data-line="25"><span data-line="25"></span>Iteration cycle reasonably slow
</li>
<li class="li ul-li list-star-li compact-li" data-line="26"><span data-line="26"></span>Unit testing a little annoying to get started but easy once established
</li></ul>
<h4 id="sec-python-for-analysis" class="h3" data-line="28" data-heading-depth="3" style="display:block"><span data-line="28"></span><span class="heading-before"><span class="heading-label">1.1.3</span>.&#8194;</span><span data-line="28"></span>Python for analysis</h4>
<ul class="ul list-star compact" data-line="29">
<li class="li ul-li list-star-li compact-li" data-line="29"><span data-line="29"></span>Quick to write/change/iterate scripts for analysis once variable importing/exporting in place
</li>
<li class="li ul-li list-star-li compact-li" data-line="30"><span data-line="30"></span>Fast enough for decent analysis <span data-line="30"></span>&amp;<span data-line="30"></span> can be improved through Cython or other c impls
</li></ul>
<h4 id="sec-code-problems-and-possible-preventions-aka-hpc-code-smells" class="h3" data-line="32" data-heading-depth="3" style="display:block"><span data-line="32"></span><span class="heading-before"><span class="heading-label">1.1.4</span>.&#8194;</span><span data-line="32"></span>Code problems and possible preventions (AKA HPC code smells)</h4>
<ul class="ul list-star compact" data-line="33">
<li class="li ul-li list-star-li compact-li" data-line="33"><span data-line="33"></span>Off by one errors; match equations to code so that reading code === reading equations
</li>
<li class="li ul-li list-star-li compact-li" data-line="34"><span data-line="34"></span>Unit testing small simple parts (like derivatives) to consistenly ensure fewer mistakes in tested parts
</li>
<li class="li ul-li list-star-li compact-li" data-line="35"><span data-line="35"></span>Difficulty<span data-line="35"></span> <span data-line="35"></span>- Equations hard to unit test, humans can<span data-line="35"></span>&#39;<span data-line="35"></span>t do so well. Best strategy seems to be match eqns <span data-line="35"></span>&amp;<span data-line="35"></span> double check everything
</li></ul>
<h3 id="sec-lagrangian-remap-lare" class="h2" data-line="37" data-heading-depth="2" style="display:block"><span data-line="37"></span><span class="heading-before"><span class="heading-label">1.2</span>.&#8194;</span><span data-line="37"></span>Lagrangian-Remap (LARE)</h3><h4 id="sec-advantages" class="h3" data-line="39" data-heading-depth="3" style="display:block"><span data-line="39"></span><span class="heading-before"><span class="heading-label">1.2.1</span>.&#8194;</span><span data-line="39"></span>Advantages</h4>
<ul class="ul list-star compact" data-line="40">
<li class="li ul-li list-star-li compact-li" data-line="40"><span data-line="40"></span>Deals with shocks well (when flux limiters<span data-line="40"></span> <span data-line="40"></span>+ artificial shock viscosity added)
</li>
<li class="li ul-li list-star-li compact-li" data-line="41"><span data-line="41"></span>Gives comparable results to Roe solvers
</li>
<li class="li ul-li list-star-li compact-li" data-line="42"><span data-line="42"></span>Due to Lagrangian step, equation solving is much simpler than Eulerian equiv
</li></ul>
<h4 id="sec-disadvantages" class="h3" data-line="44" data-heading-depth="3" style="display:block"><span data-line="44"></span><span class="heading-before"><span class="heading-label">1.2.2</span>.&#8194;</span><span data-line="44"></span>Disadvantages</h4>
<ul class="ul list-star compact" data-line="45">
<li class="li ul-li list-star-li compact-li" data-line="45"><span data-line="45"></span>Complicated two step process
</li>
<li class="li ul-li list-star-li compact-li" data-line="46"><span data-line="46"></span>BUT once remap step solved (<span data-line="46"></span>&amp;<span data-line="46"></span> just tedious geometrical problem), solved forever (physics invariant)
</li></ul>
<h4 id="sec-steps" class="h3" data-line="48" data-heading-depth="3" style="display:block"><span data-line="48"></span><span class="heading-before"><span class="heading-label">1.2.3</span>.&#8194;</span><span data-line="48"></span>Steps</h4>
<ul class="ul list-star compact" data-line="49">
<li class="li ul-li list-star-li compact-li" data-line="49"><span data-line="49"></span>Predictor
</li>
<li class="li ul-li list-star-li compact-li" data-line="50"><span data-line="50"></span>Corrector
</li>
<li class="li ul-li list-star-li compact-li" data-line="51"><span data-line="51"></span>Remap
</li></ul>
<h3 id="sec-setup" class="h2" data-line="53" data-heading-depth="2" style="display:block"><span data-line="53"></span><span class="heading-before"><span class="heading-label">1.3</span>.&#8194;</span><span data-line="53"></span>Setup</h3><h4 id="sec-equations" class="h3" data-line="54" data-heading-depth="3" style="display:block"><span data-line="54"></span><span class="heading-before"><span class="heading-label">1.3.1</span>.&#8194;</span><span data-line="54"></span>Equations</h4>
<p class="p noindent para-continue" data-line="55"><span data-line="55"></span>In Lagrangian form, the 1D Euler equations are written as
</p>
<div class="equation para-block" data-line="56" style="line-adjust:0"><span data-line="56"></span><span class="equation-before"><span class="equation-label">(1)</span></span><span data-line="56"></span>

<div class="mathdisplay para-block input-math" data-math-full="" data-line="57" style="line-adjust:0"><span class="mathdisplay math-display" data-math-full="">\[\lder{\rho} + \rho\xder{u} = 0,
\]</span></div></div>
<div class="equation para-block" data-line="59" style="line-adjust:0"><span data-line="59"></span><span class="equation-before"><span class="equation-label">(2)</span></span><span data-line="59"></span>

<div class="mathdisplay para-block input-math" data-math-full="" data-line="60" style="line-adjust:0"><span class="mathdisplay math-display" data-math-full="">\[\lder{u} + \frac{1}{\rho}\xder{p} = 0,
\]</span></div></div>
<div class="equation para-block" data-line="62" style="line-adjust:0"><span data-line="62"></span><span class="equation-before"><span class="equation-label">(3)</span></span><span data-line="62"></span>

<div class="mathdisplay para-block input-math" data-math-full="" data-line="63" style="line-adjust:0"><span class="mathdisplay math-display" data-math-full="">\[\lder{\varepsilon} + \frac{p}{\rho}\xder{u} = 0,
\]</span></div></div>
<p class="p noindent para-continued" data-line="65"><span data-line="65"></span>where <span data-line="65"></span><span class="math-inline">$\rho$</span><span data-line="65"></span> is the density, <span data-line="65"></span><span class="math-inline">$u$</span><span data-line="65"></span> is the fluid velocity, <span data-line="65"></span><span class="math-inline">$p$</span><span data-line="65"></span> is the pressire and <span data-line="65"></span><span class="math-inline">$\varepsilon$</span><span data-line="65"></span> is the specific internal energy density. Use has been made of the Lagrangian or material derivative, <span data-line="65"></span><span class="math-inline">$D/Dt = \partial/\partial t + u\partial/\partial x$</span><span data-line="65"></span>.
</p><h4 id="sec-grid" class="h3" data-line="67" data-heading-depth="3" style="display:block"><span data-line="67"></span><span class="heading-before"><span class="heading-label">1.3.2</span>.&#8194;</span><span data-line="67"></span>Grid</h4>
<p class="p noindent" data-line="68"><span data-line="68"></span>The grid on which the variables are defined is staggered, that is the velocity is defined at the boundary of the cells, with all other variables being defined at the cell centres. This is a strategy used to avoid the checkerboard instability, which arises when the pressure and velocity data points are defined on the same grid TODO cite?. Due to the staggered grid, some care has to be taken to ensure calculations involving mixtures of velocity and another variables are interpolated properly, to avoid numerical leaking of conserved quantities.
</p>
<p class="p indent para-continue" data-line="70"><span data-line="70"></span>A natural method of taking the first derivatives is to use a simple first order finite-difference scheme. Due to the staggered grid, we we can define the derivative of the velocity at the centre of a cell to be the finite difference of the velocity at the boundaries,
</p>
<div class="equation para-block" data-line="72" style="line-adjust:0"><span data-line="72"></span><span class="equation-before"><span class="equation-label">(4)</span></span><span data-line="72"></span>

<div class="mathdisplay para-block input-math" data-math-full="" data-line="73" style="line-adjust:0"><span class="mathdisplay math-display" data-math-full="">\[\xder{u}_i = \frac{u_i - u_{i-1}}{dxb_i},
\]</span></div></div>
<p class="p noindent para-continued para-continue" data-line="76"><span data-line="76"></span>and similarly we can define the derivative of density (or any of the other cell-centered variables) at the boundaries,
</p>
<div class="equation para-block" data-line="78" style="line-adjust:0"><span data-line="78"></span><span class="equation-before"><span class="equation-label">(5)</span></span><span data-line="78"></span>

<div class="mathdisplay para-block input-math" data-math-full="" data-line="79" style="line-adjust:0"><span class="mathdisplay math-display" data-math-full="">\[\xder{\rho}_i = \frac{\rho_i - \rho_{i-1}}{dxc_i},
\]</span></div></div>
<p class="p noindent para-continued" data-line="81"><span data-line="81"></span>noting that the change in <span data-line="81"></span><span class="math-inline">$x$</span><span data-line="81"></span> is now given as <span data-line="81"></span><span class="math-inline">$dxc_i$</span><span data-line="81"></span>.
</p><h3 id="sec-predictor-step" class="h2" data-line="84" data-heading-depth="2" style="display:block"><span data-line="84"></span><span class="heading-before"><span class="heading-label">1.4</span>.&#8194;</span><span data-line="84"></span>Predictor step</h3><span data-line=""></span></div>
</body>

</html>
